# Глава 1. Аналитико-проектная часть

## 1.1 Анализ предметной области

Предметная область исследования охватывает процессы домашнего и малого тепличного выращивания растений с использованием цифровых инструментов мониторинга и управления. В бытовых условиях уход за растениями часто выполняется вручную и зависит от субъективной оценки пользователя.

Без цифровой платформы типичный сценарий включает следующие особенности: полив проводится по памяти; информация о подкормке и стадиях роста фиксируется нерегулярно; показатели влажности почвы, температуры и освещенности не собираются централизованно; напоминания отсутствуют; история состояния растений не формируется; удаленное управление недоступно; аналитика и прогнозирование не выполняются. В результате систематически возникают пересушивание, перелив, пропуски полива и ошибки светового режима.

### Анализ аналогов

| Тип решения | Ключевые функции | Преимущества | Ограничения |
|---|---|---|---|
| Трекеры ухода за растениями | Напоминания, карточки растений | Простота использования | Нет управления устройствами и IoT |
| Платформы умного дома | Управление реле, сценарии | Автоматизация и удаленный доступ | Нет специализированного дневника роста |
| Дневники садовода | История роста, заметки, фото | Хорошая ретроспектива | Нет связи с датчиками и исполнительными устройствами |
| IoT-панели теплиц | Графики датчиков, алерты | Точный мониторинг среды | Сложность внедрения и слабый бытовой UX |

### SWOT-анализ

| Сильные стороны | Слабые стороны |
|---|---|
| Объединение управления и учета в одном интерфейсе | Зависимость от корректности датчиков |
| Поддержка сценариев и уведомлений | Необходимость начальной настройки зон и целей |
| История роста и событий ухода | Ограниченная точность прогноза без ML |

| Возможности | Угрозы |
|---|---|
| Интеграция с реальными IoT-контроллерами | Сбои связи с оборудованием |
| Расширение до мобильного приложения | Рост нагрузки при масштабировании |
| Добавление аналитики и рекомендаций | Риски безопасности при ошибочной конфигурации |

### Проблемы, решаемые системой

Разрабатываемая платформа устраняет фрагментарность процессов ухода, обеспечивает прозрачность состояния растений, связывает показания датчиков с действиями пользователя, автоматизирует напоминания и сценарии, формирует визуализируемую историю роста и предоставляет удаленный контроль.

### Целевая аудитория

Целевые группы: пользователи 20–50 лет, владельцы квартир/домов с мини-огородом, пользователи экосистем умного дома, энтузиасты гидропоники и микрозелени, а также малые хозяйства (мини-теплицы). Базовые потребности: удобный контроль полива и света, своевременные уведомления, понимание состояния среды по датчикам, ведение дневника роста, сохранение истории и удаленный доступ с ПК/смартфона.

## 1.2 Формирование требований

### Функциональные требования

Система реализует пользовательские функции: регистрация, авторизация, восстановление пароля, профиль, создание зон, добавление растений, ведение дневника роста (заметки, высота, состояние, фото), просмотр датчиков и истории, управление устройствами, настройка расписаний, получение уведомлений и просмотр статуса системы.

Административные функции: админ-панель, просмотр пользователей и журнала действий, контроль ролей и операций.

Дополнительные функции: эмулятор управления устройствами (API-заглушка), email-уведомления, фильтры и пагинация списков.

### Нефункциональные требования

- UX/UI: простая структура навигации, единый визуальный стиль eco-tech, информативные статус-индикаторы.
- Адаптивность: корректная работа на desktop/tablet/mobile.
- Безопасность: CSRF-токены, XSS-экранирование, подготовленные SQL-запросы, хэширование паролей, разграничение прав.
- Производительность: индексы в БД, ограничение выборок, AJAX для обновления динамики.
- Надежность: валидация данных, обработка ошибок, логирование событий.
- Совместимость: современные браузеры (Chrome, Safari, Firefox и мобильные).
- Масштабируемость: расширение числа датчиков, зон, пользователей и интеграций.

## 1.3 Техническое задание

### Цель проекта

Разработка веб-платформы для управления домашним умным садом/огородом и ведения дневника роста растений.

### Объект автоматизации

Процессы ухода за растениями в домашних условиях и мини-теплицах: мониторинг параметров среды, управление исполнительными устройствами, журналирование ухода.

### Функции системы

- модуль авторизации и учетных записей;
- модуль растений и зон;
- модуль датчиков и истории измерений;
- модуль устройств и статусов;
- модуль расписаний и сценариев;
- модуль дневника роста и событий ухода;
- модуль уведомлений;
- модуль администрирования и логов.

### Архитектура

Клиент-серверная архитектура:
- Frontend: HTML/CSS/JS, формы, таблицы, динамика AJAX.
- Backend: PHP 8 (MVC-подобная структура), маршрутизация, бизнес-логика.
- Data layer: MySQL 8 (реляционная схема, связи и индексы).
- Интеграционный слой: тестовый API-эмулятор устройств.

### Требования к БД

Реляционная схема включает сущности пользователей, ролей, растений, зон, устройств, измерений, дневника, расписаний, уведомлений и логов. Используются внешние ключи, индексы на пользовательские выборки и временные поля.

### Требования к серверу

PHP 8+, MySQL 8+, Apache/Nginx, SMTP (или локальная почтовая конфигурация), локальная среда OpenServer/XAMPP.

## 1.4 Выбор технологического стека

Frontend выбран на HTML5/CSS3/Vanilla JS, что обеспечивает прозрачность архитектуры и демонстрацию базовых веб-навыков без скрытых механизмов фреймворков. Backend выбран на PHP 8 как доступная и распространенная платформа с удобной интеграцией MySQL и быстрой реализацией CRUD и серверной логики. База данных MySQL использована как устойчивая реляционная СУБД с поддержкой транзакций, индексов и внешних ключей. Дополнительно применяются Git/GitHub, OpenServer/XAMPP, SMTP и JSON API для интеграционных сценариев.

# Глава 2. Практическая реализация

## 2.1 Настройка среды разработки

1. Установлена локальная среда OpenServer/XAMPP.
2. Создан проект `smart_garden` с веб-корнем `public/`.
3. Выполнена настройка подключения к MySQL в `config/config.php`.
4. Реализовано подключение PDO с отключенной эмуляцией prepare и режимом исключений.
5. Созданы таблицы (`sql/schema.sql`) и загружены демо-данные (`sql/seed.sql`).
6. Сформирована структура каталогов: `config`, `public`, `assets`, `app`, `routes`, `sql`, `logs`.

## 2.2 Backend

Реализованы контроллеры:
- `AuthController`: регистрация, вход, выход, восстановление пароля;
- `ProfileController`: просмотр и обновление профиля;
- `GardenController`: кабинет, растения, зоны, статус системы;
- `DiaryController`: ведение дневника и событий ухода;
- `DevicesController`: управление устройствами;
- `SensorsController`: история датчиков;
- `AutomationController`: расписания;
- `NotificationsController`: просмотр и отметка уведомлений;
- `AdminController`: пользователи и системные логи;
- `ApiController`: AJAX endpoints.

Бизнес-логика включает добавление растений и зон, сохранение целевых параметров, фиксацию показаний датчиков, ручное переключение устройств, создание расписаний, генерацию и чтение уведомлений, журналирование действий.

### Безопасность backend

- подготовленные SQL-запросы (PDO prepared statements);
- `password_hash/password_verify`;
- CSRF-проверка для POST-форм и API;
- экранирование вывода на шаблонах;
- проверка владения данными (изоляция по `user_id`);
- ограничение доступа для роли `admin`.

## 2.3 Frontend

Интерфейс реализован в стиле eco-tech: темный фон, зеленые/бирюзовые акценты, карточный UI, статусные бейджи и адаптивные сетки. Реализованы страницы регистрации, авторизации, кабинета, растений, зон, дневника, устройств, датчиков, расписаний, уведомлений, админ-панели и 404.

### AJAX-функции

- онлайн-обновление блока датчиков (`api/sensors`);
- переключение устройств (`api/devices/toggle`);
- отметка уведомлений (`api/notifications/read`);
- API-эндпоинты подготовлены для расширения.

## 2.4 Интеграция сервисов

Реализована тестовая интеграция через API-эмулятор устройств: команды включения/выключения и выдача статуса. SMTP-уведомления подключены на уровне helper (`Mailer`) и используются для регистрации и восстановления пароля. Добавлены страницы статуса системы, истории датчиков и таймлайн дневника.

## Дополнительные реализованные требования

- CSRF и XSS защита;
- обработка 404;
- базовые SEO/OG meta-теги;
- favicon и robots.txt;
- логирование ошибок (`logs/app.log`);
- пагинация списков (растения, уведомления);
- frontend/backend валидация форм.

## Инструкция по локальному запуску

1. Импортировать `sql/schema.sql`, затем `sql/seed.sql`.
2. Проверить параметры БД в `config/config.php`.
3. Настроить веб-сервер на папку `public/` (или использовать корневой `index.php`).
4. Открыть сайт в браузере и войти под демо-аккаунтом.

Доступы:
- `admin@smartgarden.local / password`
- `user@smartgarden.local / password`
